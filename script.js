// Publications data
const firstAuthorPapers = [
        {
            title: "Rethinking Verification for LLM Code Generation: From Generation to Testing",
            authors: "Zihan Ma=, Taolin Zhang=, Maosong Cao, Junnan Liu, Wenwei Zhang, Minnan Luo, Songyang Zhang, Kai Chen",
            venue: "NeurIPS 2025",
            year: "2025",
            ccf: "CCF-A",
            links: {
                paper: "https://arxiv.org/abs/2507.06920",
                code: "https://github.com/open-compass/SAGA"
            }
        },
        {
            title: "Bridging Interests and Truth: Towards Mitigating Fake News with Personalized and Truthful Recommendations",
            authors: "Zihan Ma, Minnan Luo, Yiran Hao, Zhi Zeng, Xiangzheng Kong, Jiahao Wang",
            venue: "SIGIR 2025",
            year: "2025",
            ccf: "CCF-A",
            links: {
                paper: "https://dl.acm.org/doi/abs/10.1145/3726302.3729912",
                code: "#"
            }
        },
        {
            title: "Coding Triangle: How Does Large Language Model Understand Code?",
            authors: "Taolin Zhang=, Zihan Ma=, Maosong Cao, Junnan Liu, Songyang Zhang, Kai Chen",
            venue: "arXiv preprint",
            year: "2025",
            ccf: "preprint",
            links: {
                paper: "https://arxiv.org/abs/2507.06138",
                code: "#"
            }
        },
        {
            title: "Each fake news is fake in its own way: An attribution multi-granularity benchmark for multimodal fake news detection",
            authors: "Hao Guo=, Zihan Ma=, Zhi Zeng, Minnan Luo, Weixin Zeng, Jiuyang Tang, Xiang Zhao",
            venue: "AAAI 2025",
            year: "2025",
            ccf: "CCF-A",
            links: {
                paper: "https://arxiv.org/abs/2412.14686",
                code: "https://github.com/mazihan880/AMG-An-Attributing-Multi-modal-Fake-News-Dataset"
            }
        },
        {
            title: "Event-Radar: Event-driven Multi-View Learning for Multimodal Fake News Detection",
            authors: "Zihan Ma, Minnan Luo, Hao Guo, Zhi Zeng, Yiran Hao, Xiang Zhao",
            venue: "ACL 2024",
            year: "2024",
            ccf: "CCF-A",
            links: {
                paper: "https://aclanthology.org/2024.acl-long.316/",
                code: "https://github.com/mazihan880/Event-Radar"
            }
        },
        {
            title: "Learning multimodal attention mixed with frequency domain information as detector for fake news detection",
            authors: "Zihan Ma, Huan Liu, Zhi Zeng, Hao Guo, Xiang Zhao, Minnan Luo",
            venue: "ICME 2024",
            year: "2025",
            ccf: "CCF-B",
            links: {
                paper: "https://ieeexplore.ieee.org/abstract/document/10687912/",
                code: "https://github.com/mazihan880/MHFFD"
            }
        },
        
    ];

const collaborativePapers = [
        {
            title: "Intern-S1: A scientific multimodal foundation model",
            authors: "Zihan Ma as a contributor in Intern-S1 Team",
            venue: "arXiv preprint",
            year: "2025",
            ccf: "preprint",
            links: {
                paper: "https://arxiv.org/abs/2508.15763",
                code: "#"
            }
        },
        {
            title: "How Do Social Bots Participate in Misinformation Spread? A Comprehensive Dataset and Analysis",
            authors: "Herun Wan, Minnan Luo, Zihan Ma, Guang Dai, Xiang Zhao",
            venue: "EMNLP2025",
            year: "2025",
            ccf: "CCF-B",
            links: {
                paper: "#",
                code: "#"
            }
        },
        {
            title: "DiFaR: Enhancing Multimodal Misinformation Detection with Diverse, Factual, and Relevant Rationales",
            authors: "Herun Wan, Jiaying Wu, Minnan Luo, Xiangzheng Kong, Zihan Ma, Zhi Zeng",
            venue: "arXiv preprint",
            year: "2025",
            ccf: "preprint",
            links: {
                paper: "https://arxiv.org/abs/2507.06920",
                code: "#"
            }
        },
        {
            title: "Deciphering Trajectory-Aided LLM Reasoning: An Optimization Perspective",
            authors: "Junnan Liu, Hongwei Liu, Linchen Xiao, Shudong Liu, Taolin Zhang, Zihan Ma, Songyang Zhang, Kai Chen",
            venue: "arXiv preprint",
            year: "2025",
            ccf: "preprint",
            links: {
                paper: "#",
                code: "#"
            }
        },
        {
            title: "SAGE: Scale-Aware Gradual Evolution for Continual Knowledge Graph Embedding",
            authors: "Yifei Li, Lingling Zhang, Hang Yan, Tianzhe Zhao, Zihan Ma, Muye Huang, Jun Liu",
            venue: "KDD 2025",
            year: "2025",
            ccf: "CCF-A",
            links: {
                paper: "https://arxiv.org/abs/2508.11347",
                code: "#"
            }
        },
        {
            title: "IMOL: Incomplete-Modality-Tolerant Learning for Multi-Domain Fake News Video Detection",
            authors: "Zhi Zeng, Jiaying Wu, Minnan Luo, Herun Wan, Xiangzheng Kong, Zihan Ma, Guang Dai, Qinghua Zheng",
            venue: "ACL 2025",
            year: "2025",
            ccf: "CCF-A",
            links: {
                paper: "#",
                code: "#"
            }
        },
        {
            title: "Mitigating world biases: A multimodal multi-view debiasing framework for fake news video detection",
            authors: "Zhi Zeng, Minnan Luo, Xiangzheng Kong, Huan Liu, Hao Guo, Hao Yang, Zihan Ma, Xiang Zhao",
            venue: "ACM MM 2024",
            year: "2024",
            ccf: "CCF-A",
            links: {
                paper: "#",
                code: "#"
            }
        },
        {
            title: "Twibot-22: Towards graph-based twitter bot detection",
            authors: "Zihan Ma as a contributor in Twibot-22 Team",
            venue: "NeurIPS 2022",
            year: "2022",
            ccf: "CCF-A",
            links: {
                paper: "https://arxiv.org/abs/2206.04564",
                code: "#"
            }
        }
    ];

// Function to create publication HTML
function createPublicationHTML(pub, isFirstAuthor = false) {
    // For co-author papers, don't show any links
    // For first author papers, only show links that are not "#"
    let linksHTML = '';
    if (isFirstAuthor) {
        linksHTML = Object.entries(pub.links)
            .filter(([key, url]) => url !== '#')  // Filter out placeholder links
            .map(([key, url]) => 
                `<a href="${url}" class="publication-link" target="_blank">${key.charAt(0).toUpperCase() + key.slice(1)}</a>`
            ).join('');
    }

    // Check author position to determine badge text
    let badgeText = '';
    let showBadge = false;
    
    if (isFirstAuthor) {
        // For first author papers, check Zihan Ma's position
        if (pub.authors.includes('Zihan Ma=')) {
            // Check if Zihan Ma= is the first author or co-first
            const authorsList = pub.authors.split(',').map(author => author.trim());
            const zihanPosition = authorsList.findIndex(author => author.includes('Zihan Ma='));
            badgeText = zihanPosition === 0 ? 'First Author' : 'Co-First Author';
        } else {
            // If no Zihan Ma= found, default to First Author
            badgeText = 'First Author';
        }
        showBadge = true;
    } else {
        // For co-authored papers, always show Co-Author badge
        badgeText = 'Co-Author';
        showBadge = true;
    }
    
    const badgeHTML = showBadge ? `<div class="first-author-badge">${badgeText}</div>` : '';
    
    // CCF rating badge
    const ccfBadgeHTML = pub.ccf ? `<div class="ccf-badge ccf-${pub.ccf.toLowerCase().replace('-', '')}">${pub.ccf}</div>` : '';

    return `
        <div class="publication-item ${isFirstAuthor ? 'first-author' : ''}">
            ${badgeHTML}
            ${ccfBadgeHTML}
            <div class="publication-title">${pub.title}</div>
            <div class="publication-authors">${pub.authors}</div>
            <div class="publication-venue">${pub.venue}</div>
            <div class="publication-links">${linksHTML}</div>
        </div>
    `;
}

// Function to populate publications
function populatePublications() {
    const firstAuthorContainer = document.getElementById('first-author-pubs');
    const coAuthorContainer = document.getElementById('coauthor-pubs');

    if (firstAuthorContainer) {
        firstAuthorContainer.innerHTML = firstAuthorPapers
            .map(pub => createPublicationHTML(pub, true))
            .join('');
    }

    if (coAuthorContainer) {
        coAuthorContainer.innerHTML = collaborativePapers
            .map(pub => createPublicationHTML(pub, false))
            .join('');
    }
}

// Function to update last updated date
function updateLastUpdated() {
    const lastUpdatedElement = document.getElementById('last-updated');
    if (lastUpdatedElement) {
        const now = new Date();
        const options = { 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
        };
        lastUpdatedElement.textContent = now.toLocaleDateString('en-US', options);
    }
}

// Function to handle profile image error
function handleProfileImageError() {
    const profileImg = document.getElementById('profile-img');
    if (profileImg) {
        profileImg.onerror = function() {
            // Create a placeholder SVG if image fails to load
            this.style.display = 'none';
            const placeholder = document.createElement('div');
            placeholder.style.cssText = `
                width: 180px;
                height: 180px;
                border-radius: 50%;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-size: 3rem;
                font-weight: bold;
                border: 4px solid #e0e0e0;
            `;
            placeholder.textContent = 'YN'; // You can change this to your initials
            this.parentNode.appendChild(placeholder);
        };
    }
}

// Function to add smooth scrolling to anchor links
function addSmoothScrolling() {
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });
}

// Function to add intersection observer for animations
function addScrollAnimations() {
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    }, observerOptions);

    // Observe all sections
    document.querySelectorAll('.section').forEach(section => {
        section.style.opacity = '0';
        section.style.transform = 'translateY(20px)';
        section.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
        observer.observe(section);
    });
}

// Function to add copy email functionality
function addCopyEmailFeature() {
    const emailLinks = document.querySelectorAll('a[href^="mailto:"]');
    emailLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const email = this.href.replace('mailto:', '');
            navigator.clipboard.writeText(email).then(() => {
                // Show a temporary tooltip
                const tooltip = document.createElement('div');
                tooltip.textContent = 'Email copied!';
                tooltip.style.cssText = `
                    position: absolute;
                    background: #2c3e50;
                    color: white;
                    padding: 5px 10px;
                    border-radius: 4px;
                    font-size: 12px;
                    z-index: 1000;
                    pointer-events: none;
                `;
                document.body.appendChild(tooltip);
                
                const rect = this.getBoundingClientRect();
                tooltip.style.left = rect.left + 'px';
                tooltip.style.top = (rect.top - 30) + 'px';
                
                setTimeout(() => {
                    document.body.removeChild(tooltip);
                }, 2000);
            });
        });
    });
}

function copyEmail() {
    const email = 'mazihan880@stu.xjtu.edu.cn';
    navigator.clipboard.writeText(email).then(() => {
        alert('Email copied to clipboard!');
    });
}

// Initialize everything when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    populatePublications();
    handleProfileImageError();
    addSmoothScrolling();
    addScrollAnimations();
    addCopyEmailFeature();
});

// Add some interactive features
document.addEventListener('DOMContentLoaded', function() {
    // Add hover effect to publication items
    const publicationItems = document.querySelectorAll('.publication-item');
    publicationItems.forEach(item => {
        item.addEventListener('mouseenter', function() {
            this.style.transform = 'translateX(5px) scale(1.02)';
        });
        
        item.addEventListener('mouseleave', function() {
            this.style.transform = 'translateX(0) scale(1)';
        });
    });
});

// Export functions for potential external use
window.PersonalWebsite = {
    updatePublications: populatePublications,
    updateLastUpdated: updateLastUpdated
};